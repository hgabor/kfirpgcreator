include("Screen")

function Message(msg)
  local screen = Screen()
  local text = TextGraphics(msg, "center")
  local window = WindowGraphics(text.width-1, text.height)
  local x = (screenWidth - text.width) / 2
  local y = (screenHeight - text.height) / 2
  screen:Place(x, y, window)
  screen:Place(x, y, text)
  screen:OnKeyPress(function(key) if key:IsPressed(btnAction) then screen:Hide() end end)
  screen:Show()
end

local referenceHeight = TextGraphics("test").height

function Ask(msg, ...)
  if arg.n == 0 then
    Message(msg)
    return
  end

  local screen = Screen()
  local text = TextGraphics(msg, "center")
  local answers = {}
  
  local sumHeight = 0
  for i, value in ipairs(arg) do
    answers[i] = TextGraphics(value, "left")
    sumHeight = sumHeight + answers[i].height
  end
  local selectedFrame = MenuItemBackground(answers[1].width+10, answers[1].height+10)
  
  local window = WindowGraphics(text.width-1, text.height + sumHeight + arg.n*referenceHeight)
  
  local x = (screenWidth - text.width) / 2
  local y = (screenHeight - text.height - sumHeight) / 2
  
  screen:Place(x, y, window)
  screen:Place(x, y, text)
  screen:Place(x-5, y+text.height+referenceHeight-5, selectedFrame)
  
  for i, value in ipairs(answers) do
    y = y + value.height + referenceHeight
    screen:Place(x, y, value)
    value.y = y
  end
  
  local selectedId = 1
  local maxId = arg.n
  
  screen:OnKeyPress(function(key)
    if key:IsPressed(btnUp) then
      selectedId = selectedId - 1
      if selectedId == 0 then selectedId = maxId end
      screen:Place(x-5, answers[selectedId].y-5, selectedFrame)
      
    elseif key:IsPressed(btnDown) then
      selectedId = selectedId + 1
      if selectedId == maxId+1 then selectedId = 1 end
      screen:Place(x-5, answers[selectedId].y-5, selectedFrame)
      
    elseif key:IsPressed(btnAction) then
      screen:Hide()
    end
  end)
  
  screen:Show()
  
  return selectedId
end
